<!-- Pleasant Cove Design - Client Project Workspace -->
<!-- COPY ALL OF THIS CODE INTO A SQUARESPACE CODE BLOCK -->

<div id="pleasant-cove-workspace">
  <div style="text-align: center; padding: 40px;">
    <div style="display: inline-block; width: 50px; height: 50px; border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; animation: pcd-spin 1s linear infinite;"></div>
    <p style="margin-top: 20px; color: #6b7280;">Loading your project workspace...</p>
  </div>
</div>

<style>
@keyframes pcd-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#pleasant-cove-workspace {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  line-height: 1.5;
  color: #1f2937;
}

#pleasant-cove-workspace * {
  box-sizing: border-box;
}

.pcd-container {
  max-width: 1200px;
  margin: 0 auto;
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.pcd-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 40px 30px;
  text-align: center;
}

.pcd-header h1 {
  margin: 0 0 10px 0;
  font-size: 32px;
  font-weight: 700;
}

.pcd-header p {
  margin: 0;
  font-size: 18px;
  opacity: 0.9;
}

.pcd-nav {
  display: flex;
  background: #f8f9fa;
  border-bottom: 1px solid #e2e8f0;
  overflow-x: auto;
}

.pcd-nav button {
  flex: 1;
  padding: 18px 24px;
  background: none;
  border: none;
  color: #64748b;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s;
  border-bottom: 3px solid transparent;
  white-space: nowrap;
}

.pcd-nav button:hover {
  background: #f1f3f5;
  color: #667eea;
}

.pcd-nav button.active {
  color: #667eea;
  background: white;
  border-bottom-color: #667eea;
}

.pcd-content {
  padding: 40px 30px;
  min-height: 500px;
}

.pcd-section {
  display: none;
}

.pcd-section.active {
  display: block;
}

/* Progress Styles */
.pcd-progress-container {
  margin-bottom: 40px;
}

.pcd-progress-bar {
  width: 100%;
  height: 30px;
  background: #e2e8f0;
  border-radius: 15px;
  overflow: hidden;
  margin: 20px 0;
}

.pcd-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #667eea, #764ba2);
  transition: width 0.5s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
}

.pcd-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 30px;
}

.pcd-stat-card {
  background: #f8f9fa;
  padding: 25px;
  border-radius: 10px;
  border: 1px solid #e2e8f0;
}

.pcd-stat-card h3 {
  margin: 0 0 10px 0;
  color: #64748b;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.pcd-stat-card p {
  margin: 0;
  font-size: 24px;
  font-weight: 600;
  color: #1f2937;
}

/* Messages Styles */
.pcd-messages-container {
  display: flex;
  flex-direction: column;
  height: 600px;
  background: #f8f9fa;
  border-radius: 10px;
  padding: 20px;
}

.pcd-messages-list {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  background: white;
  border-radius: 8px;
  margin-bottom: 20px;
}

.pcd-message {
  margin-bottom: 20px;
  display: flex;
  align-items: flex-start;
}

.pcd-message.client {
  flex-direction: row-reverse;
}

.pcd-message-bubble {
  max-width: 70%;
  padding: 15px 20px;
  border-radius: 18px;
  position: relative;
}

.pcd-message.team .pcd-message-bubble {
  background: #f1f3f5;
  color: #1f2937;
  margin-left: 10px;
}

.pcd-message.client .pcd-message-bubble {
  background: #667eea;
  color: white;
  margin-right: 10px;
}

.pcd-message-header {
  font-weight: 600;
  margin-bottom: 5px;
  font-size: 14px;
}

.pcd-message-time {
  font-size: 12px;
  opacity: 0.7;
  margin-top: 5px;
}

.pcd-message-input-container {
  display: flex;
  gap: 10px;
}

.pcd-message-input {
  flex: 1;
  padding: 15px 20px;
  border: 2px solid #e2e8f0;
  border-radius: 10px;
  font-size: 16px;
  outline: none;
  transition: border-color 0.3s;
}

.pcd-message-input:focus {
  border-color: #667eea;
}

.pcd-send-button {
  padding: 15px 30px;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.pcd-send-button:hover {
  background: #5a5ed8;
  transform: translateY(-1px);
}

/* Milestones Styles */
.pcd-milestones {
  margin-top: 20px;
}

.pcd-milestone {
  display: flex;
  align-items: center;
  padding: 25px;
  margin-bottom: 20px;
  background: white;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  transition: all 0.3s;
}

.pcd-milestone:hover {
  border-color: #667eea;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
}

.pcd-milestone.completed {
  background: #f0fdf4;
  border-color: #86efac;
}

.pcd-milestone-icon {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 20px;
  font-size: 24px;
  font-weight: 600;
}

.pcd-milestone.completed .pcd-milestone-icon {
  background: #86efac;
  color: #166534;
}

.pcd-milestone.pending .pcd-milestone-icon {
  background: #e2e8f0;
  color: #64748b;
}

.pcd-milestone.current .pcd-milestone-icon {
  background: #667eea;
  color: white;
}

.pcd-milestone-content h3 {
  margin: 0 0 5px 0;
  font-size: 18px;
  color: #1f2937;
}

.pcd-milestone-content p {
  margin: 0;
  color: #64748b;
}

/* Responsive */
@media (max-width: 768px) {
  .pcd-nav {
    overflow-x: scroll;
    -webkit-overflow-scrolling: touch;
  }
  
  .pcd-nav button {
    min-width: 120px;
  }
  
  .pcd-message-bubble {
    max-width: 85%;
  }
  
  .pcd-stats {
    grid-template-columns: 1fr;
  }
}

/* Loading State */
.pcd-loading {
  text-align: center;
  padding: 60px;
  color: #64748b;
}

.pcd-error {
  background: #fee2e2;
  color: #991b1b;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  margin: 20px 0;
}

/* Empty States */
.pcd-empty {
  text-align: center;
  padding: 60px 20px;
  color: #64748b;
}

.pcd-empty-icon {
  font-size: 48px;
  margin-bottom: 20px;
  opacity: 0.3;
}
</style>

<script>
// Pleasant Cove Design - Project Workspace Module
(function() {
  'use strict';

  // Configuration
  const CONFIG = {
    // CHANGE THESE TO YOUR ACTUAL URLS
    API_URL: 'https://api.pleasantcovedesign.com',
    
    // For local testing, use:
    // API_URL: 'http://localhost:3000',
    
    // Mock mode for demo (set to false when API is ready)
    USE_MOCK_DATA: true
  };

  // Mock data for demonstration
  const MOCK_DATA = {
    project: {
      id: 1,
      name: "Professional Website Development",
      companyName: "Your Company",
      progress: 65,
      currentStage: "Design Phase",
      estimatedCompletion: "2024-03-15",
      startDate: "2024-01-10",
      messages: [
        {
          id: 1,
          sender: 'team',
          senderName: 'Pleasant Cove Design',
          content: 'Welcome to your project workspace! This is where we\'ll collaborate on your website project.',
          timestamp: '2024-01-10T10:00:00Z'
        },
        {
          id: 2,
          sender: 'client',
          senderName: 'You',
          content: 'Thanks! I\'m excited to see the progress.',
          timestamp: '2024-01-10T10:30:00Z'
        },
        {
          id: 3,
          sender: 'team',
          senderName: 'Pleasant Cove Design',
          content: 'We\'ve completed the initial design concepts. You can view them in the Designs tab when they\'re uploaded.',
          timestamp: '2024-01-11T14:00:00Z'
        }
      ],
      milestones: [
        {
          id: 1,
          title: 'Project Kickoff',
          description: 'Initial consultation and requirements gathering',
          status: 'completed',
          completedDate: '2024-01-10'
        },
        {
          id: 2,
          title: 'Design Phase',
          description: 'Create mockups and design concepts',
          status: 'current',
          dueDate: '2024-02-01'
        },
        {
          id: 3,
          title: 'Development',
          description: 'Build the website functionality',
          status: 'pending',
          dueDate: '2024-02-20'
        },
        {
          id: 4,
          title: 'Testing & Review',
          description: 'Test all features and make revisions',
          status: 'pending',
          dueDate: '2024-03-01'
        },
        {
          id: 5,
          title: 'Launch',
          description: 'Deploy your website live!',
          status: 'pending',
          dueDate: '2024-03-15'
        }
      ]
    }
  };

  // Main application object
  const ProjectWorkspace = {
    data: {
      project: null,
      member: null,
      currentTab: 'overview'
    },

    init() {
      console.log('Initializing Pleasant Cove Project Workspace...');
      this.detectMember();
      this.render();
      this.loadProject();
    },

    detectMember() {
      // Try to detect Squarespace member
      let member = null;

      // Method 1: Check Squarespace context
      if (window.Static && window.Static.SQUARESPACE_CONTEXT && window.Static.SQUARESPACE_CONTEXT.authenticatedAccount) {
        const account = window.Static.SQUARESPACE_CONTEXT.authenticatedAccount;
        member = {
          id: account.id,
          email: account.email,
          name: `${account.firstName} ${account.lastName}`.trim() || account.email
        };
      }

      // Method 2: Check URL parameters (for testing)
      if (!member) {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('test') || urlParams.get('preview')) {
          member = {
            id: 'test-member',
            email: 'test@example.com',
            name: 'Test User'
          };
        }
      }

      this.data.member = member;
      console.log('Member detected:', member);
    },

    async loadProject() {
      const container = document.getElementById('pleasant-cove-workspace');
      
      if (!this.data.member) {
        container.innerHTML = `
          <div class="pcd-container">
            <div class="pcd-error">
              Please log in to your Squarespace account to view your project workspace.
            </div>
          </div>
        `;
        return;
      }

      if (CONFIG.USE_MOCK_DATA) {
        // Use mock data for demo
        this.data.project = MOCK_DATA.project;
        this.data.project.memberName = this.data.member.name;
        this.updateUI();
      } else {
        // Fetch real data from API
        try {
          const response = await fetch(`${CONFIG.API_URL}/api/workspace/member/${this.data.member.id}`);
          const result = await response.json();
          
          if (result.success && result.project) {
            this.data.project = result.project;
            this.updateUI();
          } else {
            container.innerHTML = `
              <div class="pcd-container">
                <div class="pcd-error">
                  No active project found. Please contact Pleasant Cove Design if you believe this is an error.
                </div>
              </div>
            `;
          }
        } catch (error) {
          console.error('Error loading project:', error);
          // Fall back to mock data
          this.data.project = MOCK_DATA.project;
          this.data.project.memberName = this.data.member.name;
          this.updateUI();
        }
      }
    },

    render() {
      const container = document.getElementById('pleasant-cove-workspace');
      container.innerHTML = `
        <div class="pcd-container">
          <div class="pcd-header">
            <h1>Your Project Workspace</h1>
            <p>Welcome to Pleasant Cove Design</p>
          </div>
          
          <nav class="pcd-nav">
            <button class="active" onclick="ProjectWorkspace.showTab('overview')">Overview</button>
            <button onclick="ProjectWorkspace.showTab('messages')">Messages</button>
            <button onclick="ProjectWorkspace.showTab('milestones')">Milestones</button>
          </nav>
          
          <div class="pcd-content">
            <div id="pcd-overview" class="pcd-section active">
              <div class="pcd-loading">Loading your project...</div>
            </div>
            
            <div id="pcd-messages" class="pcd-section">
              <div class="pcd-loading">Loading messages...</div>
            </div>
            
            <div id="pcd-milestones" class="pcd-section">
              <div class="pcd-loading">Loading milestones...</div>
            </div>
          </div>
        </div>
      `;
    },

    updateUI() {
      if (!this.data.project) return;

      // Update header
      const header = document.querySelector('.pcd-header h1');
      const subtitle = document.querySelector('.pcd-header p');
      if (header) header.textContent = this.data.project.name;
      if (subtitle) subtitle.textContent = `Welcome, ${this.data.project.memberName || this.data.member.name}`;

      // Update content based on current tab
      this.showTab(this.data.currentTab);
    },

    showTab(tabName) {
      this.data.currentTab = tabName;

      // Update nav buttons
      document.querySelectorAll('.pcd-nav button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.toLowerCase() === tabName) {
          btn.classList.add('active');
        }
      });

      // Hide all sections
      document.querySelectorAll('.pcd-section').forEach(section => {
        section.classList.remove('active');
      });

      // Show selected section and update content
      const section = document.getElementById(`pcd-${tabName}`);
      if (section) {
        section.classList.add('active');
        
        switch(tabName) {
          case 'overview':
            this.renderOverview();
            break;
          case 'messages':
            this.renderMessages();
            break;
          case 'milestones':
            this.renderMilestones();
            break;
        }
      }
    },

    renderOverview() {
      const section = document.getElementById('pcd-overview');
      const project = this.data.project;
      
      section.innerHTML = `
        <div class="pcd-progress-container">
          <h2>Project Progress</h2>
          <div class="pcd-progress-bar">
            <div class="pcd-progress-fill" style="width: ${project.progress}%">
              ${project.progress}%
            </div>
          </div>
        </div>
        
        <div class="pcd-stats">
          <div class="pcd-stat-card">
            <h3>Current Stage</h3>
            <p>${project.currentStage}</p>
          </div>
          
          <div class="pcd-stat-card">
            <h3>Started</h3>
            <p>${this.formatDate(project.startDate)}</p>
          </div>
          
          <div class="pcd-stat-card">
            <h3>Estimated Completion</h3>
            <p>${this.formatDate(project.estimatedCompletion)}</p>
          </div>
          
          <div class="pcd-stat-card">
            <h3>Project Manager</h3>
            <p>Pleasant Cove Design Team</p>
          </div>
        </div>
      `;
    },

    renderMessages() {
      const section = document.getElementById('pcd-messages');
      const messages = this.data.project.messages || [];
      
      let messagesHTML = '';
      messages.forEach(msg => {
        const isClient = msg.sender === 'client';
        messagesHTML += `
          <div class="pcd-message ${isClient ? 'client' : 'team'}">
            <div class="pcd-message-bubble">
              <div class="pcd-message-header">${msg.senderName}</div>
              ${msg.content}
              <div class="pcd-message-time">${this.formatDateTime(msg.timestamp)}</div>
            </div>
          </div>
        `;
      });

      if (messages.length === 0) {
        messagesHTML = '<div class="pcd-empty">No messages yet. Send us a message to start the conversation!</div>';
      }
      
      section.innerHTML = `
        <div class="pcd-messages-container">
          <div class="pcd-messages-list">
            ${messagesHTML}
          </div>
          
          <div class="pcd-message-input-container">
            <input 
              type="text" 
              class="pcd-message-input" 
              placeholder="Type your message here..."
              id="pcd-message-input"
              onkeypress="if(event.key === 'Enter') ProjectWorkspace.sendMessage()"
            >
            <button class="pcd-send-button" onclick="ProjectWorkspace.sendMessage()">
              Send
            </button>
          </div>
        </div>
      `;

      // Scroll to bottom of messages
      const messagesList = section.querySelector('.pcd-messages-list');
      if (messagesList) {
        messagesList.scrollTop = messagesList.scrollHeight;
      }
    },

    renderMilestones() {
      const section = document.getElementById('pcd-milestones');
      const milestones = this.data.project.milestones || [];
      
      let milestonesHTML = '<h2>Project Milestones</h2><div class="pcd-milestones">';
      
      milestones.forEach(milestone => {
        milestonesHTML += `
          <div class="pcd-milestone ${milestone.status}">
            <div class="pcd-milestone-icon">
              ${milestone.status === 'completed' ? '✓' : milestone.status === 'current' ? '●' : '○'}
            </div>
            <div class="pcd-milestone-content">
              <h3>${milestone.title}</h3>
              <p>${milestone.description}</p>
              ${milestone.completedDate ? `<p style="color: #16a34a; font-size: 14px; margin-top: 5px;">Completed ${this.formatDate(milestone.completedDate)}</p>` : ''}
              ${milestone.dueDate && milestone.status !== 'completed' ? `<p style="color: #64748b; font-size: 14px; margin-top: 5px;">Due ${this.formatDate(milestone.dueDate)}</p>` : ''}
            </div>
          </div>
        `;
      });
      
      milestonesHTML += '</div>';
      section.innerHTML = milestonesHTML;
    },

    async sendMessage() {
      const input = document.getElementById('pcd-message-input');
      const message = input.value.trim();
      
      if (!message) return;

      // Add message to UI immediately
      const newMessage = {
        id: Date.now(),
        sender: 'client',
        senderName: this.data.member.name,
        content: message,
        timestamp: new Date().toISOString()
      };
      
      this.data.project.messages.push(newMessage);
      input.value = '';
      this.renderMessages();

      // Send to server if not in mock mode
      if (!CONFIG.USE_MOCK_DATA) {
        try {
          await fetch(`${CONFIG.API_URL}/api/workspace/project/${this.data.project.id}/messages`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              projectId: this.data.project.id,
              memberId: this.data.member.id,
              memberEmail: this.data.member.email,
              memberName: this.data.member.name,
              content: message
            })
          });
        } catch (error) {
          console.error('Error sending message:', error);
        }
      }
    },

    formatDate(dateString) {
      if (!dateString) return 'TBD';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
    },

    formatDateTime(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      return date.toLocaleString('en-US', { 
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit',
        hour12: true
      });
    }
  };

  // Make available globally
  window.ProjectWorkspace = ProjectWorkspace;

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => ProjectWorkspace.init());
  } else {
    ProjectWorkspace.init();
  }
})();
</script>
